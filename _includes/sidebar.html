<aside class="sidebar" role="complementary" aria-label="侧边栏导航">
    
    <!-- Current Section Navigation -->
    {% assign current_url = page.url %}
    {% assign current_section = nil %}
    {% assign section_title = nil %}
    
    <!-- Determine current section -->
    {% for nav_item in site.navigation %}
        {% if nav_item.children %}
            {% for chapter in nav_item.children %}
                {% if chapter.url == current_url %}
                    {% assign current_section = nav_item %}
                    {% assign section_title = nav_item.title %}
                    {% break %}
                {% endif %}
            {% endfor %}
        {% endif %}
        {% if current_section %}
            {% break %}
        {% endif %}
    {% endfor %}
    
    {% if current_section %}
    <div class="sidebar-section current-section">
        <h3 class="sidebar-title">{{ section_title }}</h3>
        <nav class="section-nav" aria-label="{{ section_title }}导航">
            <ul class="chapter-list">
                {% for chapter in current_section.children %}
                <li class="chapter-item {% if chapter.url == current_url %}current{% endif %}">
                    <a href="{{ chapter.url | relative_url }}" class="chapter-link">
                        <span class="chapter-number">{{ forloop.index }}</span>
                        <span class="chapter-title">{{ chapter.title }}</span>
                    </a>
                </li>
                {% endfor %}
            </ul>
        </nav>
    </div>
    {% endif %}
    
    <!-- All Sections Overview -->
    <div class="sidebar-section all-sections">
        <h3 class="sidebar-title">所有章节</h3>
        <nav class="all-sections-nav" aria-label="所有章节导航">
            {% for nav_item in site.navigation %}
                {% if nav_item.children %}
                <div class="section-group {% if nav_item == current_section %}active{% endif %}">
                    <div class="section-header">
                        <a href="{{ nav_item.url | relative_url }}" class="section-link">
                            {{ nav_item.title }}
                        </a>
                        <span class="section-count">{{ nav_item.children.size }} 章节</span>
                    </div>
                    
                    {% if nav_item == current_section %}
                    <ul class="section-chapters">
                        {% for chapter in nav_item.children %}
                        <li class="section-chapter {% if chapter.url == current_url %}current{% endif %}">
                            <a href="{{ chapter.url | relative_url }}" class="section-chapter-link">
                                {{ chapter.title }}
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                    {% endif %}
                </div>
                {% endif %}
            {% endfor %}
        </nav>
    </div>
    
</aside>